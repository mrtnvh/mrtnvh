---
import { orderBy, defaultsDeep } from 'lodash-es';
import { format } from 'date-fns';
import BaseLayout from '../../layouts/Base.astro';
import List from '../../components/List/List.astro';
import Folio from '../../components/Page/Folio.astro';

const dateNow = format(new Date(), 'yyyyMMdd');
const allPublications = await Astro.glob('./*.mdx').then((files) =>
  files.map(({ frontmatter, ...data }) => ({
    ...data,
    ...frontmatter,
  })),
);
const allPublicationsOrdered = orderBy(allPublications, ['datePublished'], ['desc']);
const publications = allPublicationsOrdered.filter(({ datePublished }) => datePublished <= dateNow);
const baseLayoutProps = defaultsDeep(
  {
    content: {
      title: 'Publications',
      description: 'Blogposts, significant tweets and inspiring links',
    },
  },
  Astro.props,
);
---

<BaseLayout {...baseLayoutProps}>
  <Folio title="Publications">
    <List items={publications} large />
  </Folio>
</BaseLayout>
